<div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Edit Introduction</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <%= form_tag( {:controller=>"profiles", :action => :create, }, { :method => :post }) do %>
          <div class="modal-body bodyEditProfile">
            <div class="containerProfileModal">
              <div class="celr" id="gridBackground" style="background-image: url(<%= image_path ('life-862972_1920.jpg') %>);">
                <div class="cel">
                  <div class="imgBackgraound">
                    <img class="profileImg" src="<%= image_path ('person_4.jpg') %>">
                    <div class="editProfilePicIconCont">
                      <a class="buttonEditProfilePic">
                       <%= file_field_tag :projectphoto,class: 'form-control fieldinput d-none' %>
                        <img class="editProfilePicIcon" src="<%= image_path ('Icons/edit.png') %>">
                      </a>
                      <i style="display:none;margin-left: 89%;float: right;margin-top: -4%;position:absolute" class="fa fa-spinner" id="loaderimage"></i>
                      <i style="display:none;margin-left: 89%;float: right;margin-top: -4%;color:green;position:absolute" class="fa fa-check" id="check"></i>
                      <input type="text" hidden id="url" name="url">
                    </div>
                    <div class="editProfilePic">

                      <div class="editProfilePicSelect" id="editProfilePicSelect">
                        <% if @profile.profile_photo.blank? %>
                        <%= file_field_tag :pro_photo,class: 'form-control field_input' %>
                        <%= hidden_field_tag :profile_photo%>
                        <<% else %>
                        <img src="<%= @profile.profile_photo %>" alt="Image" class="profileImg">
                        <%#= file_field_tag :pro_photo,class: 'form-control field_input' %>
                        <%#= hidden_field_tag :profile_photo%>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="cel"></div>
                <div class="cel"></div>
              </div>
              <div class="celr" id=gridForm>
                <div class="celr" id=gridLabels>
                  <div class="cel boldText title">First Name *</div>
                  <div class="cel boldText title">Last Name *</div>
                </div>
                <div class="celr" id="gridLabels">
                  <div class="cel input">
                    <%= text_field_tag :name,@user.firstname,class: 'inputFname',:readonly => true %>
                    <!-- <input type="text" name="fname" class="inputFname"> -->
                  </div>
                  <div class="cel ">
                    <%= text_field_tag :name,@user.lastname,class: 'inputLname',:readonly => true %>
                    <!-- <input type="text" name="lname" class="inputLname"> -->
                  </div>
                </div>
                <div class="cel" id="gridPersonal">
                  <div class="cel boldText title">Personal Summary</div>
                  <div class="cel">
                    <%= text_area_tag :bio,@profile.bio,class: 'txtPersonal',placeholder: "Bio" %>
                  </div>
                  <!-- <div class="margin">
                  <div class="cel boldText title">Current Position</div>
                  <div class="cel"><input type="text" name="pSummary" class="inputP"></div>
                </div> -->
              </div>
              <div class="celr margin" id="gridSelect">
                <div class="cel boldText title">Fluent Languages *</div>
              </div>
              		<div class="form-group custom-from-group" id="select-languages-wrap">
                      <label for="birth-day">Spoken Language(s)</label>
                      <%= select_tag "language", options_from_collection_for_select(LanguageList::COMMON_LANGUAGES, "iso_639_3", "name"), {class:"custom-select"}%>

                  </div>
                  <button type="button" class="btn btn-link" id="addLanguageBtn">Add+</button>
              <!-- <div class="celr marginOption" id="gridOption">
              <div class="tags-input" data-name="tags-input">
              <span class="tag">CSS<span class="close"></span></span>
              <span class="tag">JavaScript<span class="close"></span></span>
              <span class="tag">HTML<span class="close"></span></span>
            </div>
          </div> -->

          <div class="form-row">
            <div class="form-group col-md-4 custom-from-group pl-0">
              <label>Country</label>
              <select id="countries" class="custom-select" name="country">
                <option value="" selected=<%=@profile.country%>>Select Your Country</option>
                <% CS.countries.each do |key, value| %>
                <option value="<%= key %>"><%= value %></option>
                <% end %>
              </select>
            </div>

            <div class="form-group col-md-4 custom-from-group">
              <label>State/Provience</label>
              <select id="states-of-country" class="custom-select" name="state">
                <option value="" selected=<%=@profile.state%>>Select Your Country</option>
              </select>


            </div>

            <div class="form-group col-md-4 custom-from-group pr-0">
              <label for="city">City</label>
              <select id="cities-of-state" class="custom-select" name="city">
                <option value="" selected=<%=@profile.city%>>Select Your Country</option>
              </select>

            </div>
          </div>

          <!-- <div class="celr margin" id="gridProfile">
          <div class="cel boldText title">Profile URL</div>
          <div class="cel"></div>
          <div class="cel"></div>
          <div class="cel">10h1.org/p/</div>
          <div class="cel inputProfile"><input type="text" name="inputProfile" class="profileinput"></div>
          <div class="cel"></div>
        </div> -->
      </div>
    </div>
    <div class="modal-footer">
      <div class="celr" id="gridbtnSave">
        <div class="cel btnSave">
          <% if @new_profile %>
          <%= submit_tag("Save",:id=>"submit", :class=>'buttonSave next-button')%>
          <% else %>
          <%= submit_tag("Save",:id=>"submit", :class=>'buttonSave next-button')%>
          <% end %>


          <!--      <button type="submit" class="btn btn-primary text-white button-addon" data-dismiss="modal">Update Profile</button>-->
        </div>
        <!-- <div class="cel btnSave">
        <button type="button" class="buttonSave">Save</button>
      </div> -->
    </div>
    </div>
    </div>

      <%end%>

<script>
  [].forEach.call(document.getElementsByClassName('tags-input'), function (el) {
    let hiddenInput = document.createElement('input'),
    mainInput = document.createElement('input'),
    tags = [];

    hiddenInput.setAttribute('type', 'hidden');
    hiddenInput.setAttribute('name', el.getAttribute('data-name'));

    mainInput.setAttribute('type', 'text');
    mainInput.classList.add('main-input');
    mainInput.addEventListener('input', function () {
      let enteredTags = mainInput.value.split('.');
      if (enteredTags.length > 1) {
        enteredTags.forEach(function (t) {
          let filteredTag = filterTag(t);
          if (filteredTag.length > 0)
          addTag(filteredTag);
        });
        mainInput.value = '';
      }
    });

    mainInput.addEventListener('keydown', function (e) {
      let keyCode = e.which || e.keyCode;
      if (keyCode === 8 && mainInput.value.length === 0 && tags.length > 0) {
        removeTag(tags.length - 1);
      }
    });

    el.appendChild(mainInput);
    el.appendChild(hiddenInput);

    addTag('Languages');


    function addTag (text) {
      let tag = {
        text: text,
        element: document.createElement('span'),
      };

      tag.element.classList.add('tag');
      tag.element.textContent = tag.text;

      let closeBtn = document.createElement('span');
      closeBtn.classList.add('close');
      closeBtn.addEventListener('click', function () {
        removeTag(tags.indexOf(tag));
      });
      tag.element.appendChild(closeBtn);

      tags.push(tag);

      el.insertBefore(tag.element, mainInput);

      refreshTags();
    }

    function removeTag (index) {
      let tag = tags[index];
      tags.splice(index, 1);
      el.removeChild(tag.element);
      refreshTags();
    }

    function refreshTags () {

    }

    function filterTag (tag) {
      return tag.replace(/[^\w -]/g, '').trim().replace(/\W+/g, '-');
    }


  });
  function selectPic() {
    var selectPic = document.getElementById("editProfilePicSelect");
    if (selectPic.style.opacity == 0) {
      selectPic.style.opacity = 1;
    }
    else{
      if (selectPic.style.opacity == 1) {
        selectPic.style.opacity = 0;
      }
    }
  }

  $('.editProfilePicIcon').click(function(){
    $( "#projectphoto" ).trigger( "click" );
  })

  var languages = 1;
  var objectLanguages = [];
	$('#addLanguageBtn').on('click', function () {
    var clonedSelect = $('#select-languages-wrap select').first().clone(false)
    clonedSelect.attr('id', 'language-'+languages);
		$('#select-languages-wrap').append(clonedSelect)
    languages += 1;
		clonedSelect.wrap('<div></div>')
  })

  $('.next-button').click(function(){
    objectLanguages[0] = $('#language').val();
    for (let i = 1; i <= languages-1; i++) {
      objectLanguages[i] = $('#language-'+i).val();
    }
    console.log(objectLanguages);
  })

</script>
<script>
    $(document).ready(function(){
        $("input[type=file]").change(function(e){
            $('#loaderimage').fadeIn();
            $('#loaderimage').addClass('fa-spin');
            var storage = firebase.storage();
            var storageRef = firebase.storage().ref();
            if(e.target.id == "projectphoto"){
                var file=document.getElementById("projectphoto").files[0];
                console.log(file);
                var thisref = storageRef.child("category/"+file.name).put(file);

            }
            else if(e.target.id == "edit_url"){
                var file=document.getElementById("edit_url").files[0];
                console.log(file);
                var thisref = storageRef.child("category/"+file.name).put(file);

            }

            thisref.on('state_changed',function(snapshot){
                console.log("File Uploaded Successfully");
            },function (error) {

            },function() {
                thisref.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                    if(e.target.id=="projectphoto")
                    {
                      $('#url').val(downloadURL);
                        profile = document.getElementById("url").value = downloadURL;
                    }
                    else if(e.target.id=="edit_url")
                    {
                        profile = document.getElementById("edurl").value = downloadURL;
                    }
                    $('#loaderimage').fadeOut();
                    $('#check').fadeIn();
                })});
        });
    });
</script>

</div>
</div>
</div>
