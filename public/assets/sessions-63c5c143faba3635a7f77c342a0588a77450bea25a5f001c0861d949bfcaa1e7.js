jQuery(document).ready(function(e){function t(e){var t=e?e.split("?")[1]:window.location.search.slice(1),n={};if(t)for(var i=(t=t.split("#")[0]).split("&"),a=0;a<i.length;a++){var o=i[a].split("="),r=o[0],c="undefined"==typeof o[1]||o[1];if(r=r.toLowerCase(),"string"==typeof c&&(c=c.toLowerCase()),r.match(/\[(\d+)?\]$/)){var l=r.replace(/\[(\d+)?\]/,"");if(n[l]||(n[l]=[]),r.match(/\[\d+\]$/)){var d=/\[(\d+)\]/.exec(r)[1];n[l][d]=c}else n[l].push(c)}else n[r]?n[r]&&"string"==typeof n[r]?(n[r]=[n[r]],n[r].push(c)):n[r].push(c):n[r]=c}return n}function n(e,t){(document.getElementById("month-"+T).classList.remove("active"),document.getElementById("month-"+e).classList.add("active"),T=e,t)&&document.querySelector(".months-wrap .active").scrollIntoView()}function i(e){var t=document.querySelector(".very-custom-calendar-wrap .calendar-current-date .month-placeholder"),n=document.querySelector(".very-custom-calendar-wrap .calendar-current-date .day-placeholder");t.innerText=e.format("dddd ."),n.innerText=e.format("D MMM")}function a(e,t,n,i){return e<i&&t<n}function o(){e("#newEventAddDetails").removeClass("d-none"),e("#newEventAddDetailsBtn").addClass("d-none")}function r(){e("#newEventAddDetails").addClass("d-none"),e("#newEventAddDetailsBtn").removeClass("d-none")}function c(t){var n=t.startTime,i=t.endTime,a=t.setDate,c=t.title,l=t.description;e("#newEventStartTimepicker").val(n),e("#newEventEndTimepicker").val(i),e("#newEventDatePicker").val(a),c?e("#newEventSubject").val(c):e("#newEventSubject").val(""),l?(e("#newEventAddDetailsTextArea").val(l),o()):(e("#newEventAddDetailsTextArea").val(""),r())}function l(t){var n=t.startTime,i=t.endTime,a=t.setDate,o=t.title,r=t.description;e("#newEventStartTimepickerMoreOption").val(n),e("#newEventEndTimepickerMoreOption").val(i),e("#newEventDatePickerMoreOption").val(a),e("#newEventMoreOptionsCurrentDate").text(a),e("#newEventDatePickerMoreOption").change(function(){k=e("#newEventDatePickerMoreOption").val()}),e("#newEventStartTimepickerMoreOption").change(function(){w=e("#newEventStartTimepickerMoreOption").val()}),e("#newEventEndTimepickerMoreOption").change(function(){h=e("#newEventEndTimepickerMoreOption").val()}),o&&e("#newEventSubjectMoreOption").val(o),r&&e("#newEventAddDetailsTextAreaMoreOption").val(r)}function d(){var t='<div class="position-relative mt-3">\n                      <select class="custom-select mr-2 fz-14 gray-input d-inline-block notification-select">\n                        <option value="email" selected>Email</option>\n                        <option value="notification">Notification</option>\n                      </select>\n\n                      <input type="text" class="form-control mr-2 gray-input d-inline-block notification-duration-input" placeholder="30">\n\n                      <select class="custom-select fz-14 gray-input d-inline-block notification-duration-type-input">\n                        <option value="minutes" selected>minutes</option>\n                        <option value="hours">hours</option>\n                        <option value="days">days</option>\n                        <option value="weeks">weeks</option>\n                      </select>\n\n                      <button type="button" class="d-inline-block btn btn-link btn-link-close" aria-label="Close">\n                        <span aria-hidden="true">&times;</span>\n                      </button>\n                  </div>',n=document.createElement("div");n.innerHTML=t,e("#notif-wrap").append(n),e(n).find(".btn-link-close").on("click",function(){m(e(this))})}function m(t){e(t).parent().remove()}function s(t){return t||(t={}),Object.assign({header:{left:"",center:"",right:""},plugins:["dayGrid","timeGrid","interaction"],defaultView:"timeGridDay",nowIndicator:!0,allDaySlot:!1,contentHeight:800,selectable:!0,selectHelper:!0,eventOverlap:!1,datesRender:function(){Array.from(document.querySelectorAll(".fc-scroller")).forEach(function(e){new PerfectScrollbar(e)})},eventClick:function(){},select:function(t){var n=E.view.type,i=moment.utc(moment(t.end).diff(moment(t.start))).valueOf();if(Math.floor(i/6e4)>("timeGridDay"===n?30:1440))E.unselect(),e("#newEventMultipleTimeSelect").modal();else{if(E.getEvents().some(function(e){return!(!e.start||!e.end)&&a(e.start.getTime(),t.start.getTime(),e.end.getTime(),t.end.getTime())}))return void e("#newEventTimeConflict").modal();e.getScript("/sessions/new",function(){c({startTime:moment(t.start).format("hh:mm A"),endTime:moment(t.end).format("hh:mm A"),setDate:moment(t.start).format("D MMM YYYY")}),w=moment(t.start).format("hh:mm A"),h=moment(t.end).format("hh:mm A"),k=moment(t.start).format("D MMM YYYY"),e("#newEventDialog form").submit(function(){return e(".start_hidden").val(k+" "+w),e(".end_hidden").val(k+" "+h),!0}),e("#newEventDialog").removeClass("edit-view").modal(),e("#newEventAddDetailsBtn").on("click",function(){o()}),e("#newEventMoreOptionBtn").on("click",function(){e("#newEventMoreOptionDialog").modal(),l({startTime:e("#newEventStartTimepicker").val(),endTime:e("#newEventEndTimepicker").val(),setDate:e("#newEventDatePicker").val(),title:e("#booking_title").val(),description:e("#newEventAddDetailsTextArea").val()})}),e(".new-event-time-picker").mdtimepicker(),e("#newEventStartTimepicker").mdtimepicker().on("timechanged",function(e){w=e.value}),e("#newEventEndTimepicker").mdtimepicker().on("timechanged",function(e){h=e.value}),e(".new-event-date-picker").bootstrapMaterialDatePicker({weekStart:0,time:!1,format:"D MMM YYYY"}),e(".new-event-date-picker").change(function(e){k=e.target.value})})}},events:function(t,n,i){e(".gooey-wrap").removeClass("d-none");var a=function(t){e(".gooey-wrap").addClass("d-none"),i(t)},o=function(t){e(".gooey-wrap").addClass("d-none"),n(t)};p&&u?e.ajax({url:"/bookings.json"+window.location.search+"&self=1&other=1",dataType:"JSON",success:o,error:a}):!p&&u?e.ajax({url:"/bookings.json"+window.location.search+"&self=1&other=0",dataType:"JSON",success:o,error:a}):p&&!u?e.ajax({url:"/bookings.json"+window.location.search+"&self=0&other=1",dataType:"JSON",success:o,error:a}):e.ajax({url:"/bookings.json"+window.location.search+"&self=0&other=0",dataType:"JSON",success:o,error:a})},eventRender:function(e){var t=e.event.extendedProps.eventDescription,n=e.event.extendedProps.eventName,i=e.event.extendedProps.hasStar;if(t){var a=document.createElement("div");a.innerText=t,a.classList.add("fc-event-description"),e.el.append(a)}if(n){var o=document.createElement("div");o.innerText=n,o.classList.add("fc-event-name"),e.el.append(o)}if(i){var r=document.createElement("i");r.innerText="star",r.classList.add("fc-event-star"),r.classList.add("material-icons"),e.el.append(r)}}},t)}function v(){E.refetchEvents(),M.refetchEvents()}var u=!0,p=!0,f=document.querySelectorAll(".timeline-calendar");params=t(window.location.href);var w="08:00 AM",h="08:30 AM",k=moment().format("D MMM YYYY");if(f.length){var E=new FullCalendar.Calendar(f[0],s());window.timelineCalendar=E;var M=new FullCalendar.Calendar(f[1],s({contentHeight:400,select:function(t){console.log(t);var n=E.view.type,i=moment.utc(moment(t.end).diff(moment(t.start))).valueOf();if(Math.floor(i/6e4)>("timeGridDay"===n?30:1440))E.unselect();else{if(E.getEvents().some(function(e){return a(e.start.getTime(),t.start.getTime(),e.end.getTime(),t.end.getTime())}))return void e("#newEventTimeConflict").modal();l({startTime:moment(t.start).format("hh:mm A"),endTime:moment(t.end).format("hh:mm A"),setDate:moment(t.start).format("D MMM YYYY")}),w=moment(t.start).format("hh:mm A"),h=moment(t.end).format("hh:mm A"),k=moment(t.start).format("D MMM YYYY")}},eventRender:function(e){var t=e.event.extendedProps.eventDescription,n=e.event.extendedProps.eventName,i=e.event.extendedProps.hasStar;if(t){var a=document.createElement("div");a.innerText=t,a.classList.add("fc-event-description"),e.el.append(a)}if(n){var o=document.createElement("div");o.innerText=n,o.classList.add("fc-event-name"),e.el.append(o)}if(i){var r=document.createElement("i");r.innerText="star",r.classList.add("fc-event-star"),r.classList.add("material-icons"),e.el.append(r)}}}));if(E.render(),M.render(),D=document.querySelector(".very-custom-calendar")){var D;(D=new FullCalendar.Calendar(D,{plugins:["dayGrid","interaction","moment"],header:{left:"",center:"",right:""},aspectRatio:1,selectable:!0,select:function(e){moment.utc(moment(e.end).diff(moment(e.start))).format("D")>2?D.unselect():(E.gotoDate(e.start),i(moment(e.start)),n(moment(e.start).format("M")))}})).render(),new PerfectScrollbar(document.querySelector(".months-wrap")),new PerfectScrollbar(document.querySelector(".fc-scroller")),e(".new-event-time-picker").mdtimepicker(),e(".new-event-date-picker").bootstrapMaterialDatePicker({weekStart:0,time:!1,format:"D MMM YYYY"});var g=moment(D.getDate()),T=g.format("M");n(T,!0),i(g),e(".months-wrap .month").on("click",function(){var t=e(this).attr("id").replace("month-",""),i="1",a=g.format("Y");D.gotoDate(moment(t+"-"+i+"-"+a,"MM-DD-YYYY").format()),n(t)}),e("#daily").on("click",function(){E.changeView("timeGridDay")}),e("#weekly").on("click",function(){E.changeView("dayGridWeek")}),e("#monthly").on("click",function(){E.changeView("dayGridMonth")}),e("#booking-add-event-btn").on("click",function(){var t=moment().format("D MMM YYYY");e.getScript("/sessions/new",function(){c({startTime:w,endTime:h,setDate:k}),e("#newEventAddDetailsBtn").on("click",function(){o()}),e("#newEventMoreOptionBtn").on("click",function(){e("#newEventMoreOptionDialog").modal(),l({startTime:e("#newEventStartTimepicker").val(),endTime:e("#newEventEndTimepicker").val(),setDate:t,title:e("#booking_title").val(),description:e("#newEventAddDetailsTextArea").val()})}),e(".new-event-time-picker").mdtimepicker(),e("#newEventStartTimepicker").mdtimepicker().on("timechanged",function(e){w=e.value}),e("#newEventEndTimepicker").mdtimepicker().on("timechanged",function(e){h=e.value}),e(".new-event-date-picker").bootstrapMaterialDatePicker({weekStart:0,time:!1,format:"D MMM YYYY"}),e(".new-event-date-picker").change(function(e){k=e.target.value}),e("#newEventDialog").removeClass("edit-view").modal()})}),e("#more-options-tab2-tab").on("click",function(){setTimeout(function(){M.updateSize()})}),e("#new_booking").submit(function(){return c({startTime:e("#newEventStartTimepickerMoreOption").val(),endTime:e("#newEventEndTimepickerMoreOption").val(),setDate:e("#newEventDatePickerMoreOption").val(),title:e("#newEventSubjectMoreOption").val(),description:e("#newEventAddDetailsTextAreaMoreOption").val()}),e(".start_hidden").val(k+" "+w),e(".end_hidden").val(k+" "+h),!0}),e("#newEventMoreOptionTodayBtn").on("click",function(){var t=moment();M.gotoDate(t.format()),e("#newEventMoreOptionsCurrentDate").text(t.format("D MMM YYYY"))}),e("#newEventMoreOptionNextDayBtn").on("click",function(){var t=moment(M.getDate()).add(1,"day");M.gotoDate(t.format()),e("#newEventMoreOptionsCurrentDate").text(t.format("D MMM YYYY"))}),e("#newEventMoreOptionPrevDayBtn").on("click",function(){var t=moment(M.getDate()).subtract(1,"day");M.gotoDate(t.format()),e("#newEventMoreOptionsCurrentDate").text(t.format("D MMM YYYY"))}),e("#addNotifButton").on("click",function(){d()}),e("#current_user_checkbox").change(function(){p=this.checked,v()}),e("#other_user_checkbox").change(function(){u=this.checked,v()})}}});